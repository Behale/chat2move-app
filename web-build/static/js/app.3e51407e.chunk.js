(this.webpackJsonp=this.webpackJsonp||[]).push([[0],{150:function(e,t,n){"use strict";n.r(t),function(e){var r,o;n.d(t,"isDev",(function(){return i})),n.d(t,"host",(function(){return a})),n.d(t,"isLocal",(function(){return c}));var i="development"===(null==(r=e)||null==(o=r.env)?void 0:o.NODE_ENV),a="chat2move.herokuapp.com",c=function(e){return"localhost"===e||"[::1]"===e||e.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)}}.call(this,n(228))},391:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return an}));var r=n(8),o=n.n(r),i=(n(568),n(393)),a=n(0),c=n.n(a),s=n(584),u=n(582),l=n(5),f=n.n(l),d=n(11),p=n.n(d),h=n(335),v=n(249),y=n(248);function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(Object(n),!0).forEach((function(t){f()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var j=n(398);var m=n(305),O=n(297),w=n(131),x=n(580),k=n(383),P=n(12),S=n(21),I=n.n(S),C=n(13),E=n(27),A=n(58),_=n(9),D=n(7);function B(e){var t=e.navigation;return Object(D.jsxs)(_.default,{style:z.container,children:[Object(D.jsx)(E.default,{style:z.title,children:"This screen doesn't exist."}),Object(D.jsx)(A.default,{onPress:function(){return t.replace("Root")},style:z.link,children:Object(D.jsx)(E.default,{style:z.linkText,children:"Go to home screen!"})})]})}var z=C.default.create({container:{flex:1,backgroundColor:"#fff",alignItems:"center",justifyContent:"center",padding:20},title:{fontSize:20,fontWeight:"bold"},link:{marginTop:15,paddingVertical:15},linkText:{fontSize:14,color:"#2e78b7"}}),M=n(123),R=n(99),N=n(24),L=n.n(N),U=n(17),T=n.n(U),F=n(2),q=n.n(F),W=n(3),J=n.n(W),V=n(4),Y=n.n(V),H=n(6),G=n.n(H),X=n(1),$=n.n(X),K=n(579),Q=n(28),Z=n.n(Q),ee=n(122),te=n.n(ee),ne=n(225),re=function(){var e=o()((function*(e){var t=yield ne.default.getItem("@papercups"+e);if(!t)return null;try{return JSON.parse(t)}catch(n){return t}}));return function(t){return e.apply(this,arguments)}}(),oe=function(){var e=o()((function*(e,t){return ne.default.setItem("@papercups"+e,JSON.stringify(t))}));return function(t,n){return e.apply(this,arguments)}}(),ie=function(){var e=o()((function*(e){return ne.default.removeItem("@papercups"+e)}));return function(t){return e.apply(this,arguments)}}(),ae={get:re,set:oe,remove:ie,auth:{get:function(){var e=o()((function*(){return re("@papercups:auth")}));return function(){return e.apply(this,arguments)}}(),set:function(){var e=o()((function*(e){return oe("@papercups:auth",e)}));return function(t){return e.apply(this,arguments)}}(),remove:function(){var e=o()((function*(){return ie("@papercups:auth")}));return function(){return e.apply(this,arguments)}}()}},ce=n(150);function se(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ue(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?se(Object(n),!0).forEach((function(t){f()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):se(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var le=(Object(ce.isLocal)(ce.host)?"http://":"https://")+ce.host,fe=function(){var e=o()((function*(){var e=yield ae.get("@papercups:auth");return e&&e.token||null}));return function(){return e.apply(this,arguments)}}(),de=function(){var e=o()((function*(){var e=yield ae.get("@papercups:auth");return e&&e.renew_token||null}));return function(){return e.apply(this,arguments)}}(),pe=function(){var e=o()((function*(e){var t=e||(yield fe());if(!t)throw new Error("Invalid token!");return Z.a.get(le+"/api/me").set("Authorization",t).then((function(e){return e.body.data}))}));return function(t){return e.apply(this,arguments)}}(),he=function(){var e=o()((function*(e){var t=e.email,n=e.password;return Z.a.post(le+"/api/session").send({user:{email:t,password:n}}).then((function(e){return e.body.data}))}));return function(t){return e.apply(this,arguments)}}(),ve=function(){var e=o()((function*(){return Z.a.delete(le+"/api/session").then((function(e){return e.body}))}));return function(){return e.apply(this,arguments)}}(),ye=function(){var e=o()((function*(e){var t=e.companyName,n=e.inviteToken,r=e.email,o=e.password,i=e.passwordConfirmation;return Z.a.post(le+"/api/registration").send({user:{company_name:t,invite_token:n,email:r,password:o,password_confirmation:i}}).then((function(e){return e.body.data}))}));return function(t){return e.apply(this,arguments)}}(),be=function(){var e=o()((function*(e){var t=e||(yield de());if(!t)throw new Error("Invalid token!");return Z.a.post(le+"/api/session/renew").set("Authorization",t).then((function(e){return e.body.data}))}));return function(t){return e.apply(this,arguments)}}(),ge=(function(){var e=o()((function*(e,t){return Z.a.post(le+"/api/customers").send({customer:ue(ue({},t),{},{account_id:e})}).then((function(e){return e.body.data}))}))}(),function(){var e=o()((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=t||(yield fe());if(!n)throw new Error("Invalid token!");return Z.a.get(le+"/api/customers").query(te.a.stringify(e,{arrayFormat:"bracket"})).set("Authorization",n).then((function(e){return e.body}))}))}(),function(){var e=o()((function*(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,r=n||(yield fe());if(!r)throw new Error("Invalid token!");var o=t.expand,i=void 0===o?[]:o;return Z.a.get(le+"/api/customers/"+e).query(te.a.stringify({expand:i},{arrayFormat:"bracket"})).set("Authorization",r).then((function(e){return e.body.data}))}));return function(t){return e.apply(this,arguments)}}()),je=(function(){var e=o()((function*(e,t,n){var r=n||(yield fe());if(!r)throw new Error("Invalid token!");return Z.a.put(le+"/api/customers/"+e).set("Authorization",r).send({customer:t}).then((function(e){return e.body.data}))}))}(),function(){var e=o()((function*(e,t,n){var r=n||(yield fe());if(!r)throw new Error("Invalid token!");return Z.a.post(le+"/api/conversations").set("Authorization",r).send({conversation:ue({customer_id:e},t)}).then((function(e){return e.body.data}))}))}(),function(){var e=o()((function*(e){var t=e||(yield fe());if(!t)throw new Error("Invalid token!");return Z.a.get(le+"/api/accounts/me").set("Authorization",t).then((function(e){return e.body.data}))}))}(),function(){var e=o()((function*(e,t){var n=t||(yield fe());if(!n)throw new Error("Invalid token!");return Z.a.put(le+"/api/accounts/me").set("Authorization",n).send({account:e}).then((function(e){return e.body.data}))}))}(),function(){var e=o()((function*(e){var t=e||(yield fe());if(!t)throw new Error("Invalid token!");return Z.a.get(le+"/api/profile").set("Authorization",t).then((function(e){return e.body.data}))}))}(),function(){var e=o()((function*(e,t){var n=t||(yield fe());if(!n)throw new Error("Invalid token!");return Z.a.put(le+"/api/profile").set("Authorization",n).send({user_profile:e}).then((function(e){return e.body.data}))}))}(),function(){var e=o()((function*(e){var t=e||(yield fe());if(!t)throw new Error("Invalid token!");return Z.a.get(le+"/api/user_settings").set("Authorization",t).then((function(e){return e.body.data}))}))}(),function(){var e=o()((function*(e,t){var n=t||(yield fe());if(!n)throw new Error("Invalid token!");return Z.a.put(le+"/api/user_settings").set("Authorization",n).send({user_settings:e}).then((function(e){return e.body.data}))}));return function(t,n){return e.apply(this,arguments)}}()),me=(function(){var e=o()((function*(e){var t=e||(yield fe());if(!t)throw new Error("Invalid token!");return Z.a.get(le+"/api/conversations/unread").set("Authorization",t).then((function(e){return e.body.data}))}))}(),function(){var e=o()((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=t||(yield fe());if(!n)throw new Error("Invalid token!");return Z.a.get(le+"/api/conversations").query(e).set("Authorization",n).then((function(e){return e.body}))}));return function(){return e.apply(this,arguments)}}()),Oe=(function(){var e=o()((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return me(ue(ue({},e),{},{status:"open"}),t)}))}(),function(){var e=o()((function*(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return me(ue(ue({},t),{},{assignee_id:e||"me",status:"open"}),n)}))}(),function(){var e=o()((function*(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return me(ue(ue({},t),{},{mentioning:e||"me",status:"open"}),n)}))}(),function(){var e=o()((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return me(ue(ue({},e),{},{priority:"priority",status:"open"}),t)}))}(),function(){var e=o()((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return me(ue(ue({},e),{},{status:"closed"}),t)}))}(),function(){var e=o()((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return me(ue(ue({},e),{},{status:"open",read:!1}),t)}))}(),function(){var e=o()((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return me(ue(ue({},e),{},{status:"open",assignee_id:null}),t)}))}(),function(){var e=o()((function*(e,t){var n=t||(yield fe());if(!n)throw new Error("Invalid token!");return Z.a.get(le+"/api/conversations/"+e).set("Authorization",n).then((function(e){return e.body.data}))}));return function(t,n){return e.apply(this,arguments)}}()),we=(function(){var e=o()((function*(e,t){var n=t||(yield fe());if(!n)throw new Error("Invalid token!");return Z.a.get(le+"/api/conversations/"+e+"/previous").set("Authorization",n).then((function(e){return e.body.data}))}))}(),function(){var e=o()((function*(e,t){var n=t||(yield fe());if(!n)throw new Error("Invalid token!");return Z.a.get(le+"/api/conversations/"+e+"/related").set("Authorization",n).then((function(e){return e.body.data}))}))}(),function(){var e=o()((function*(e,t){var n=t||(yield fe());if(!n)throw new Error("Invalid token!");return Z.a.get(le+"/api/slack_conversation_threads").query({conversation_id:e}).set("Authorization",n).then((function(e){return e.body.data}))}))}(),function(){var e=o()((function*(e,t){var n=t||(yield fe());if(!n)throw new Error("Invalid token!");return Z.a.post(le+"/api/conversations/"+e+"/share").set("Authorization",n).then((function(e){return e.body.data}))}))}(),function(){var e=o()((function*(e,t){var n=t||(yield fe());if(!n)throw new Error("Access denied!");return Z.a.get(le+"/api/conversations/shared").query({token:n,conversation_id:e}).then((function(e){return e.body.data}))}))}(),function(){var e=o()((function*(e,t,n){var r=n||(yield fe());if(!r)throw new Error("Invalid token!");return Z.a.put(le+"/api/conversations/"+e).set("Authorization",r).send(t).then((function(e){return e.body.data}))}));return function(t,n,r){return e.apply(this,arguments)}}()),xe=(function(){var e=o()((function*(e,t){var n=t||(yield fe());if(!n)throw new Error("Invalid token!");return Z.a.delete(le+"/api/conversations/"+e).set("Authorization",n).then((function(e){return e.body}))}))}(),function(){var e=o()((function*(e,t){var n=t||(yield fe());if(!n)throw new Error("Invalid token!");return Z.a.post(le+"/api/conversations/"+e+"/archive").set("Authorization",n).then((function(e){return e.body}))}))}(),function(){var e=o()((function*(e,t,n){var r=n||(yield fe());if(!r)throw new Error("Invalid token!");return Z.a.post(le+"/api/messages").set("Authorization",r).send({message:ue({conversation_id:e,sent_at:(new Date).toISOString()},t)}).then((function(e){return e.body.data}))}))}(),function(){var e=o()((function*(e){var t=e||(yield fe());if(!t)throw new Error("Invalid token!");return Z.a.get(le+"/api/messages/count").set("Authorization",t).then((function(e){return e.body.data}))}))}(),function(){var e=o()((function*(e,t){return Z.a.get(le+"/api/conversations/customer").query({customer_id:e,account_id:t}).then((function(e){return e.body.data}))}))}(),function(){var e=o()((function*(e,t){var n=t||(yield fe());if(!n)throw new Error("Invalid token!");return Z.a.post(le+"/api/slack/notify").send(e).set("Authorization",n).then((function(e){return e.body.data}))}))}(),function(){var e=o()((function*(e,t){var n=t||(yield fe());if(!n)throw new Error("Invalid token!");return Z.a.post(le+"/api/twilio/send").send(e).set("Authorization",n).then((function(e){return e.body.data}))}))}(),function(){var e=o()((function*(e){var t=e||(yield fe());if(!t)throw new Error("Invalid token!");return Z.a.get(le+"/api/github/repos").set("Authorization",t).then((function(e){return e.body.data}))}))}(),function(){var e=o()((function*(e,t){var n=t||(yield fe());if(!n)throw new Error("Invalid token!");return Z.a.get(le+"/api/github/issues").query(e).set("Authorization",n).then((function(e){return e.body.data}))}))}(),function(){var e=o()((function*(e,t){var n=e.recipient,r=e.subject,o=e.message,i=t||(yield fe());if(!i)throw new Error("Invalid token!");return Z.a.post(le+"/api/gmail/send").send({recipient:n,subject:r,message:o}).set("Authorization",i).then((function(e){return e.body.data}))}))}(),function(){var e=o()((function*(e,t){var n=t||(yield fe());if(!n)throw new Error("Invalid token!");return Z.a.put(le+"/api/widget_settings").send({widget_settings:e}).set("Authorization",n).then((function(e){return e.body.data}))}))}(),function(){var e=o()((function*(e){var t=e||(yield fe());if(!t)throw new Error("Invalid token!");return Z.a.get(le+"/api/users").set("Authorization",t).then((function(e){return e.body.data}))}))}(),function(){var e=o()((function*(e,t){var n=t||(yield fe());if(!n)throw new Error("Invalid token!");return Z.a.get(le+"/api/users/"+e).set("Authorization",n).then((function(e){return e.body.data}))}))}(),function(){var e=o()((function*(e,t,n){var r=n||(yield fe());if(!r)throw new Error("Invalid token!");return Z.a.post(le+"/api/notes").set("Authorization",r).send({note:{body:t,customer_id:e}}).then((function(e){return e.body.data}))}))}(),function(){var e=o()((function*(e,t){var n=t||(yield fe());if(!n)throw new Error("Invalid token!");return Z.a.delete(le+"/api/notes/"+e).set("Authorization",n)}))}(),function(){var e=o()((function*(e){var t=e||(yield fe());if(!t)throw new Error("Invalid token!");return Z.a.get(le+"/api/tags").set("Authorization",t).then((function(e){return e.body.data}))}))}(),function(){var e=o()((function*(e,t){var n=t||(yield fe());if(!n)throw new Error("Invalid token!");return Z.a.get(le+"/api/tags/"+e).set("Authorization",n).then((function(e){return e.body.data}))}))}(),function(){var e=o()((function*(e,t){var n=t||(yield fe());if(!n)throw new Error("Invalid token!");return Z.a.post(le+"/api/tags").send({tag:e}).set("Authorization",n).then((function(e){return e.body.data}))}))}(),function(){var e=o()((function*(e,t,n){var r=n||(yield fe());if(!r)throw new Error("Invalid token!");return Z.a.put(le+"/api/tags/"+e).send({tag:t}).set("Authorization",r).then((function(e){return e.body.data}))}))}(),function(){var e=o()((function*(e,t){var n=t||(yield fe());if(!n)throw new Error("Invalid token!");return Z.a.delete(le+"/api/tags/"+e).set("Authorization",n).then((function(e){return e.body}))}))}(),function(){var e=o()((function*(e,t,n){var r=n||(yield fe());if(!r)throw new Error("Invalid token!");return Z.a.post(le+"/api/conversations/"+e+"/tags").send({tag_id:t}).set("Authorization",r).then((function(e){return e.body.data}))}))}(),function(){var e=o()((function*(e,t,n){var r=n||(yield fe());if(!r)throw new Error("Invalid token!");return Z.a.delete(le+"/api/conversations/"+e+"/tags/"+t).set("Authorization",r).then((function(e){return e.body.data}))}))}(),function(){var e=o()((function*(e,t,n){var r=n||(yield fe());if(!r)throw new Error("Invalid token!");return Z.a.post(le+"/api/customers/"+e+"/tags").send({tag_id:t}).set("Authorization",r).then((function(e){return e.body.data}))}))}(),function(){var e=o()((function*(e,t,n){var r=n||(yield fe());if(!r)throw new Error("Invalid token!");return Z.a.delete(le+"/api/customers/"+e+"/tags/"+t).set("Authorization",r).then((function(e){return e.body.data}))}))}(),n(57)),ke=n.n(xe),Pe=n(139),Se=n.n(Pe);function Ie(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ce(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ie(Object(n),!0).forEach((function(t){f()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ie(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}ke.a.extend(Se.a);var Ee=function(e){return e.reduce((function(e,t){var n=t.id;return Ce(Ce({},e),{},f()({},n,t))}),{})},Ae=function(e){return e.reduce((function(e,t){var n=t.id,r=t.messages,o=void 0===r?[]:r;return Ce(Ce({},e),{},f()({},n,o.sort((function(e,t){return+new Date(t.created_at)-+new Date(e.created_at)}))))}),{})},_e=n(38),De=n(583),Be=n(576),ze=n(577),Me=n(578),Re=(n(339),n(202)),Ne=n.n(Re),Le=n(245),Ue=function(e){try{return e instanceof Error?e.toString():"object"===typeof e?JSON.stringify(e,null,2):"string"===typeof e?e:String(e)}catch(t){return String(e)}},Te=function(e,t){var n=Ne()(t),r=n[0],o=n.slice(1);if("string"===typeof r&&o.length>0){var i="["+e+"] "+r;Le.default.alert(i,o.map((function(e){return Ue(e)})).join("\n"),[{text:"Dismiss"}],{cancelable:!0})}else Le.default.alert(e,t.map((function(e){return Ue(e)})).join("\n"),[{text:"Dismiss"}],{cancelable:!0})},Fe={debug:function(){var e;(e=console).debug.apply(e,arguments)},log:function(){var e;(e=console).log.apply(e,arguments)},info:function(){var e;(e=console).info.apply(e,arguments)},warn:function(){var e;(e=console).warn.apply(e,arguments)},error:function(){var e;(e=console).error.apply(e,arguments)},critical:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];(e=console).error.apply(e,n),Te("Error",n)}};function qe(){return We.apply(this,arguments)}function We(){return(We=o()((function*(){return"granted"===(yield De.getPermissionsAsync()).status||"granted"===(yield De.requestPermissionsAsync()).status}))).apply(this,arguments)}function Je(){return(Je=o()((function*(){var e=null;if(_e.default.isDevice){if(!(yield qe()))return Fe.warn("Failed to get push token for push notification!"),null;e=(yield Be.default()).data}else Fe.warn("Must use physical device for push notifications");return"android"===P.default.OS&&ze.default("default",{name:"default",importance:Me.AndroidImportance.MAX,vibrationPattern:[0,250,250,250],lightColor:"#FF231F7C"}),e}))).apply(this,arguments)}var Ve=["data"];function Ye(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function He(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ye(Object(n),!0).forEach((function(t){f()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ye(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ge(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=$()(e);if(t){var o=$()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return G()(this,n)}}var Xe=c.a.createContext({loading:!1,conversations:[],currentUser:null,pagination:{previous:null,next:null,limit:null,total:null},reconnect:function(){return Promise.resolve()},fetchConversations:function(){return Promise.resolve({data:[],next:null,previous:null,limit:null,total:null})},fetchConversationById:function(){return Promise.resolve(null)},updateConversationById:function(){return Promise.resolve(null)},getConversationById:function(){return null},getMessagesByConversationId:function(){return[]},markConversationAsRead:function(){return null},sendNewMessage:function(){return null}}),$e=function(){return Object(a.useContext)(Xe)},Ke=function(e){Y()(n,e);var t=Ge(n);function n(e){var r;return q()(this,n),(r=t.call(this,e)).channel=null,r.subscriptions=[],r.connect=function(){var e=o()((function*(e){r.joinNotificationsChannel(e),yield r.registerForPushNotifications()}));return function(t){return e.apply(this,arguments)}}(),r.reconnect=o()((function*(){var e=r.state.currentUser,t=null==e?void 0:e.account_id;t?(yield r.connect(t),yield r.fetchConversations({status:"open"})):Fe.critical("Cannot reconnect until current user is available:",r.state)})),r.registerForPushNotifications=o()((function*(){console.debug("Registering push notifications...");var e=yield function(){return Je.apply(this,arguments)}();console.debug("Expo push token:",e),e&&(yield je({expo_push_token:e}),r.setState({pushNotificationToken:e}),console.log("Successfully registered push notifications!",e),r.subscriptions=[].concat(T()(r.subscriptions),[K.addNotificationReceivedListener((function(e){console.log("addNotificationReceivedListener",e)})),K.addNotificationResponseReceivedListener((function(e){console.log("addNotificationResponseReceivedListener",e)}))]))})),r.removePushNotificationListeners=function(){console.log("removePushNotificationListeners"),r.subscriptions.forEach((function(e){K.removeNotificationSubscription(e)}))},r.joinNotificationsChannel=function(e){r.state.connecting?console.debug("Alreading connecting to channel... Skipping for now."):(r.setState({connecting:!0}),r.channel&&r.channel.leave&&(console.debug("Channel already exists. Leaving channel before connecting..."),r.channel.leave()),r.channel=r.props.socket.channel("notification:"+e,{}),r.channel.on("shout",(function(e){return r.handleIncomingMessage(e)})),r.channel.on("conversation:created",(function(e){var t=e.id;return r.handleNewConversation(t)})),r.channel.on("conversation:updated",(function(e){var t=e.id,n=e.updates;return r.handleConversationUpdated(t,n)})),r.channel.onError((function(){Fe.error("Error connecting to notification channel. Attempting reconnect after 1s..."),setTimeout((function(){return r.reconnect()}),1e3)})),r.channel.join().receive("ok",(function(e){console.debug("Joined channel successfully:",e),r.setState({connecting:!1})})).receive("error",(function(e){r.setState({connecting:!1}),Fe.critical("Unable to join channel:",e),Fe.error("Attempting reconnect after 1s..."),setTimeout((function(){return r.reconnect()}),1e3)})).receive("timeout",(function(e){r.setState({connecting:!1}),Fe.critical("Connection to channel timed out:",e),Fe.error("Attempting reconnect after 1s..."),setTimeout((function(){return r.reconnect()}),1e3)})))},r.leaveNotificationsChannel=function(){r.channel&&r.channel.leave&&r.channel.leave()},r.updateConversationState=function(e){var t=e.id,n=e.messages,o=void 0===n?[]:n,i=r.state,a=i.conversationIds,c=void 0===a?[]:a,s=i.conversationsById,u=void 0===s?{}:s,l=i.messagesByConversationId,d=void 0===l?{}:l;r.setState({conversationIds:T()(new Set([].concat(T()(c),[t]))),conversationsById:He(He({},u),{},f()({},t,e)),messagesByConversationId:He(He({},d),{},f()({},t,o))})},r.fetchConversations=o()((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{status:"open"};try{var t=yield me(e),n=t.data,o=void 0===n?[]:n,i=L()(t,Ve),a=r.state,c=a.conversationIds,s=void 0===c?[]:c,u=a.conversationsById,l=void 0===u?{}:u,f=a.messagesByConversationId,d=void 0===f?{}:f;return r.setState({pagination:i,conversationIds:T()(new Set([].concat(T()(s),T()(o.map((function(e){return e.id})))))),conversationsById:He(He({},l),Ee(o)),messagesByConversationId:He(He({},d),Ae(o))}),t}catch(p){throw Fe.critical("Failed to fetch conversations:",p),p}})),r.fetchConversationById=function(){var e=o()((function*(e){try{var t=yield Oe(e);return r.updateConversationState(t),t}catch(n){throw Fe.critical("Failed to fetch conversation:",e,n),n}}));return function(t){return e.apply(this,arguments)}}(),r.updateConversationById=function(){var e=o()((function*(e,t){try{var n=yield we(e,t);return r.updateConversationState(n),n}catch(o){throw Fe.critical("Failed to update conversation:",e,t,o),o}}));return function(t,n){return e.apply(this,arguments)}}(),r.getConversationById=function(e){var t=r.state.conversationsById[e];return t||(Fe.warn("Missing conversation in cache for id: "+e),null)},r.getAllConversations=function(){return r.state.conversationIds.map((function(e){return r.getConversationById(e)})).filter((function(e){return!!e})).filter((function(e){var t=e.messages,n=void 0===t?[]:t;return n&&n.length>0})).sort((function(e,t){var n=e.last_activity_at||e.updated_at,r=t.last_activity_at||t.updated_at;return+new Date(r)-+new Date(n)}))},r.getMessagesByConversationId=function(e){var t=r.state.messagesByConversationId[e];return t||(Fe.warn("Missing messages in cache for conversation: "+e),[])},r.addMessagesByConversationId=function(e,t){return He(He({},r.state.messagesByConversationId),{},f()({},e,[].concat(T()(r.getMessagesByConversationId(e)),T()(t))))},r.handleIncomingMessage=function(e){var t=e.conversation_id;r.setState({messagesByConversationId:He(He({},r.state.messagesByConversationId),{},f()({},t,[e].concat(T()(r.getMessagesByConversationId(t)))))})},r.handleNewConversation=function(){var e=o()((function*(e){yield r.fetchConversations({status:"open"})}));return function(t){return e.apply(this,arguments)}}(),r.handleConversationUpdated=function(){var e=o()((function*(e,t){var n=r.getConversationById(e);return n?(r.setState({conversationsById:He(He({},r.state.conversationsById),{},f()({},e,He(He({},n),t)))}),r.fetchConversations({status:"open"})):r.fetchConversations({status:"open"})}));return function(t,n){return e.apply(this,arguments)}}(),r.markConversationAsRead=function(e){var t;e&&(null==(t=r.channel)||t.push("read",{conversation_id:e}).receive("ok",(function(t){console.debug("Marked as read!",{response:t,conversationId:e}),r.handleConversationUpdated(e,{read:!0})})))},r.sendNewMessage=function(e){if(!e||!e.conversation_id)throw new Error("Invalid message "+e+" - a `conversation_id` is required.");var t=e.body,n=!t||0===t.trim().length;r.channel&&!n&&(console.log("Attempting to send message to channel",e),r.channel.push("shout",He(He({},e),{},{sent_at:(new Date).toISOString()})))},r.state={loading:!0,connecting:!1,currentUser:null,pushNotificationToken:null,conversationIds:[],conversationsById:{},messagesByConversationId:{},pagination:{previous:null,next:null,limit:null,total:null}},r}return J()(n,[{key:"componentDidMount",value:function(){var e=o()((function*(){var e=this;yield this.fetchConversations({status:"open"});var t=yield pe(),n=t.account_id;this.setState({currentUser:t,loading:!1},(function(){return e.connect(n)}))}));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){this.disconnect()}},{key:"disconnect",value:function(){this.leaveNotificationsChannel(),this.removePushNotificationListeners()}},{key:"render",value:function(){var e=this.state,t=e.loading,n=e.currentUser,r=e.pagination,o=this.getAllConversations();return Object(D.jsx)(Xe.Provider,{value:{loading:t,currentUser:n,conversations:o,pagination:r,reconnect:this.reconnect,fetchConversations:this.fetchConversations,fetchConversationById:this.fetchConversationById,updateConversationById:this.updateConversationById,markConversationAsRead:this.markConversationAsRead,getConversationById:this.getConversationById,getMessagesByConversationId:this.getMessagesByConversationId,sendNewMessage:this.sendNewMessage},children:this.props.children})}}]),n}(c.a.Component);function Qe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ze(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Qe(Object(n),!0).forEach((function(t){f()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Qe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}ke.a.extend(Se.a);var et=function(e,t){return e.user_id&&t.user_id?e.user_id===t.user_id:!(!e.customer_id||!t.customer_id)&&e.customer_id===t.customer_id},tt=function(e){var t=function(e){return e.reduce((function(e,t){var n=t.user,r=t.customer;return n&&n.id?Ze(Ze({},e),{},f()({},"user:"+n.id,n)):r&&r.id?Ze(Ze({},e),{},f()({},"customer:"+r.id,r)):e}),{})}(e);return Object.keys(t).map((function(e){return t[e]}))},nt=function(e){var t=ke()(),n=t.subtract(1,"day");if(e.isAfter(t.startOf("day")))return"Last seen today";if(e.isAfter(n.startOf("day"))&&e.isBefore(n.endOf("day")))return"Last seen yesterday";var r=t.diff(e,"hours");return"Last seen "+Math.floor(r/24)+"d ago"},rt=function(e){return"bot"===e.type},ot=function(e,t){var n=e.user,r=e.customer;if(rt(e))return(null==t?void 0:t.company_name)||"Bot";if(n){var o=n.display_name,i=n.full_name,a=n.email;return o||i||a||"Agent"}if(r){var c=r.name,s=r.email;return c||s||"Anonymous User"}return"Anonymous User"},it=n(51),at=function(){},ct=function(e){return new Promise((function(t){return setTimeout(t,e)}))},st=function(e){return e?["red","yellow","green","purple","indigo"][parseInt(e,32)%5]:"blue"},ut=function(e){try{var t,n,r,o=null!=(t=null==e||null==(n=e.response)||null==(r=n.body)?void 0:r.error)?t:{},i=o.errors,a=void 0===i?{}:i,c=o.message;return 422===o.status&&Object.keys(a).length>0?"Error: "+Object.keys(a).map((function(e){var t=a[e];return t?e+" "+t:"invalid "+e})).join(", ")+".":c||(null==e?void 0:e.message)||"Something went wrong. Please contact us or try again in a few minutes."}catch(f){var s,u,l;return(null==e||null==(s=e.response)||null==(u=s.body)||null==(l=u.error)?void 0:l.message)||(null==e?void 0:e.message)||"Something went wrong. Please contact us or try again in a few minutes."}},lt=n(144);function ft(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function dt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ft(Object(n),!0).forEach((function(t){f()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ft(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}ke.a.extend(Se.a);var pt=function(e){var t=e.conversation,n=e.onPressCustomer,r=e.onPressBack,o=t.customer,i=t.messages,a=void 0===i?[]:i,c=o.name,s=o.email,u=o.id,l=o.profile_photo_url,f=p()(a,1)[0],d=c||s||"Anonymous User",h=st(u),v=ke()(o.last_seen_at),y=ke.a.utc(f.created_at).local(),b=y.isAfter(v)?nt(y):nt(v);return Object(D.jsx)(_.default,{style:I()("p-4 flex-row"),children:Object(D.jsxs)(_.default,{style:I()("flex-row items-center"),children:[Object(D.jsx)(A.default,{style:I()("pr-2"),onPress:r,children:Object(D.jsx)(lt.Icon,{name:"chevron-left",type:"feather",color:Object(S.getColor)("blue-500"),onPress:r})}),Object(D.jsxs)(A.default,{onPress:n,style:I()("flex-row"),children:[l?Object(D.jsx)(it.default,{style:dt({},I()("mr-3 w-10 h-10 rounded-full items-center justify-center")),source:{uri:l}}):Object(D.jsx)(_.default,{style:dt({},I()("mr-3 w-10 h-10 bg-"+h+"-500 rounded-full items-center justify-center")),children:Object(D.jsx)(E.default,{style:I()("text-white text-base"),children:d.slice(0,1).toUpperCase()})}),Object(D.jsxs)(_.default,{children:[Object(D.jsx)(E.default,{style:I()("text-base font-medium"),children:d}),Object(D.jsx)(E.default,{style:I()("text-gray-500"),children:b})]})]})]})})};function ht(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function vt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ht(Object(n),!0).forEach((function(t){f()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ht(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var yt=function(e){var t=e.style,n=void 0===t?{}:t;return Object(D.jsx)(_.default,{style:vt(vt({},I()("mr-3 w-8 h-8 rounded-full items-center justify-center")),n)})},bt=function(e){var t=e.style,n=void 0===t?{}:t,r=e.message,o=r.customer_id,i=function(e,t){var n=e.user,r=e.customer;return rt(e)?(null==t?void 0:t.company_logo_url)||null:n?n.profile_photo_url||null:r&&r.profile_photo_url||null}(r),a=st(o),c=ot(r);return i?Object(D.jsx)(it.default,{style:vt(vt({},I()("mr-3 mb-1 w-8 h-8 rounded-full items-center justify-center")),n),source:{uri:i}}):Object(D.jsx)(_.default,{style:vt(vt({},I()("mr-3 mb-1 w-8 h-8 bg-"+a+"-500 rounded-full items-center justify-center")),n),children:Object(D.jsx)(E.default,{style:I()("text-white text-base"),children:c.slice(0,1).toUpperCase()})})},gt=function(e){var t=e.attachment,n=t.id,r=t.content_type,o=t.file_url;return r.startsWith("image")?Object(D.jsx)(it.default,{style:vt(vt({},I()("mt-2 bg-gray-100 rounded-lg")),{width:"80%",height:void 0,aspectRatio:1}),resizeMode:"contain",source:{uri:o}},n):null},jt=function(e){var t=e.item,n=e.currentUser,r=e.avatar,o=e.label,i=e.style,a=void 0===i?{}:i,c=t.body,s=t.user_id,u=t.attachments,l=void 0===u?[]:u;return s&&(null==n?void 0:n.id)==s?Object(D.jsx)(_.default,{style:vt(vt({},I()("mb-2 px-4 justify-end")),a),children:Object(D.jsxs)(_.default,{style:I()("py-2 px-3 bg-blue-500 ml-6 rounded-lg self-end"),children:[Object(D.jsx)(E.default,{style:I()("text-white text-base"),children:c}),l.map((function(e){return Object(D.jsx)(gt,{attachment:e},e.id)}))]})}):Object(D.jsx)(_.default,{style:vt(vt({},I()("mb-2 px-4 justify-start")),a),children:Object(D.jsxs)(_.default,{style:I()("flex-row items-end"),children:[r,Object(D.jsxs)(_.default,{style:I()("mr-6"),children:[o,Object(D.jsxs)(_.default,{style:I()("py-2 px-3 bg-gray-100 mr-6 rounded-lg self-start"),children:[Object(D.jsx)(E.default,{style:I()("text-base"),children:c}),l.map((function(e){return Object(D.jsx)(gt,{attachment:e},e.id)}))]})]})]})})},mt=n(75);function Ot(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function wt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ot(Object(n),!0).forEach((function(t){f()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ot(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var xt=function(e){var t=e.onSendMessage,n=a.useState(""),r=p()(n,2),o=r[0],i=r[1];return Object(D.jsxs)(_.default,{style:I()("px-4 pb-4 pt-3 flex-row items-end"),children:[Object(D.jsx)(mt.default,{style:wt(wt({},I()("p-3 rounded-xl border-gray-200 bg-gray-50 flex-1")),{},{borderWidth:C.default.hairlineWidth}),multiline:!0,placeholder:"Send a message...",value:o,onChangeText:i}),Object(D.jsx)(A.default,{style:wt({},I()("border ml-3 py-3 px-5 border-gray-100 rounded-xl items-center")),activeOpacity:.4,onPress:function(){t(o),i("")},children:Object(D.jsx)(E.default,{style:I()("text-"+(o?"blue":"gray")+"-500"),children:"Send"})})]})};function kt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Pt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?kt(Object(n),!0).forEach((function(t){f()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):kt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function St(e){var t=e.route,n=e.navigation,r=$e(),i=r.currentUser,c=r.reconnect,u=r.fetchConversations,l=r.getConversationById,d=r.getMessagesByConversationId,h=r.markConversationAsRead,v=r.sendNewMessage,y=Object(s.useSafeAreaInsets)(),b=a.useState(!1),g=p()(b,2),j=g[0],m=g[1],O=t.params.conversationId,w=l(O),x=d(O),k=tt(x),P=function(e){return e.reduce((function(e,t){var n=t.created_at;if(ke.a.utc(n).isAfter(ke()().startOf("day")))return Ze(Ze({},e),{},{Today:(e.Today||[]).concat(t)});var r=ke.a.utc(n).local().format("MMM D");return Ze(Ze({},e),{},f()({},r,(e[r]||[]).concat(t)))}),{})}(x),S=Object.keys(P).map((function(e){return{date:e,data:P[e]}}));a.useEffect((function(){var e=l(O),t=x[x.length-1];if(e&&t)return!e.read&&t.customer?h(O):void 0}),[x.length]);var C=function(){var e=o()((function*(){m(!0),yield u({status:"open"}),yield c(),yield ct(400),m(!1)}));return function(){return e.apply(this,arguments)}}();return Object(D.jsxs)(D.Fragment,{children:[w&&Object(D.jsx)(R.default,{style:Pt(Pt({},I()("flex-none bg-gray-50")),{},{paddingTop:y.top}),children:Object(D.jsx)(pt,{conversation:w,onPressBack:function(){n.navigate("Conversations")},onPressCustomer:function(){var e=w&&w.customer_id;e&&n.navigate("CustomerDetails",{customerId:e})}})}),Object(D.jsxs)(R.default,{style:Pt(Pt({},I()("flex-1 bg-white")),{},{paddingBottom:y.bottom}),children:[Object(D.jsx)(_.default,{style:I()("flex-1"),children:Object(D.jsx)(M.default,{refreshing:j,onRefresh:C,contentContainerStyle:I()("py-3"),keyboardShouldPersistTaps:"never",scrollEventThrottle:16,inverted:!0,onEndReached:function(){return console.log("onEndReached")},onEndReachedThreshold:.5,onMomentumScrollBegin:function(){console.log("onMomentumScrollBegin")},sections:S,keyExtractor:function(e,t){return e.id},renderItem:function(e){var t=e.item,n=e.section,r=e.index,o=n.data,a=void 0===o?[]:o,c=a[r-1],s=a[r+1],u=!!s&&et(t,s),l=!(!!c&&et(t,c)),f=k.length>2;return Object(D.jsx)(jt,{item:t,style:I()(l?"mb-4":"mb-2"),currentUser:i,avatar:l?Object(D.jsx)(bt,{message:t}):Object(D.jsx)(yt,{}),label:!u&&f?Object(D.jsx)(E.default,{style:I()("ml-1 mt-"+(0===r?0:3)+" mb-1 text-gray-400 text-xs"),children:ot(t)}):null})},renderSectionFooter:function(e){var t=e.section.date;return Object(D.jsx)(_.default,{style:I()("mt-3 mb-5 items-center"),children:Object(D.jsx)(E.default,{style:I()("text-gray-500"),children:t})})}})}),Object(D.jsx)(xt,{onSendMessage:function(e){return v({body:e,conversation_id:O})}})]})]})}var It=n(124),Ct={prefixes:[It.makeUrl("/")],config:{screens:{Login:"login",Conversations:"conversations",Chat:"messages/:conversationId",NotFound:"*"}},getInitialURL:function(){var e=o()((function*(){var e=yield It.getInitialURL();if(e)return e;var t=yield K.getLastNotificationResponseAsync(),n=null==t?void 0:t.notification.request.content.data.url;return n&&"string"===typeof n?It.makeUrl("/")+n:null}));return function(){return e.apply(this,arguments)}}(),subscribe:function(e){var t=function(t){var n=t.url;return e(n)};It.addEventListener("url",t);var n=K.addNotificationResponseReceivedListener((function(t){var n=t.notification.request.content.data.url;if(n&&"string"===typeof n){var r=It.makeUrl("/")+n;e(r)}}));return function(){It.removeEventListener("url",t),n.remove()}}},Et=n(140),At=n(47),_t=n(394),Dt=n(138);function Bt(e){var t=e.item,n=e.onSelectConversation,r=t.read,o=t.customer,i=void 0===o?{}:o,a=t.messages,c=void 0===a?[]:a,s=i.id,u=i.name,l=i.email,f=i.profile_photo_url,d=u||l||"Anonymous User",h=p()(c,1)[0],v=h.body||"...",y=function(e){var t=ke.a.utc(e).local(),n=ke.a.utc(e).isAfter(ke()().startOf("day")),r=ke()().diff(ke.a.utc(e),"days")<6;return n?t.format("h:mm a"):r?t.format("ddd"):t.format("MMM D")}(h.created_at),b=v.split("\n").map((function(e){return e.trim()})).filter((function(e){return e.length>0})).join(" "),g=st(s);return Object(D.jsx)(Dt.default,{underlayColor:Object(S.getColor)("gray-300"),onPress:function(){return n(t)},children:Object(D.jsxs)(_.default,{style:I()("flex-row p-3 border-b border-gray-100 items-center bg-white"),children:[f?Object(D.jsx)(it.default,{style:I()("mr-3 w-10 h-10 rounded-full items-center justify-center"),source:{uri:f}}):Object(D.jsx)(_.default,{style:I()("mr-3 w-10 h-10 bg-"+g+"-500 rounded-full items-center justify-center"),children:Object(D.jsx)(E.default,{style:I()("text-white text-base"),children:d.slice(0,1).toUpperCase()})}),Object(D.jsxs)(_.default,{style:I()("flex-1"),children:[Object(D.jsx)(E.default,{style:I()("mb-1 text-base "+(r?"":"font-bold")),children:d}),Object(D.jsxs)(E.default,{numberOfLines:1,ellipsizeMode:"tail",style:I()(r?"text-gray-500":"text-gray-700 font-bold"),children:[b.length>36?b.slice(0,32).concat("..."):b," \xb7 ",y]})]})]})})}function zt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Mt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?zt(Object(n),!0).forEach((function(t){f()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):zt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Rt(e){var t=e.navigation,n=a.useState(!1),r=p()(n,2),i=r[0],c=r[1],u=$e(),l=u.pagination,f=u.conversations,d=void 0===f?[]:f,h=u.reconnect,v=u.fetchConversations,y=u.updateConversationById,b=Object(s.useSafeAreaInsets)(),g=function(e){var n=e.id,r=e.messages,o=void 0===r?[]:r;t.navigate("Chat",{conversationId:n,messages:o})},j=function(){var e=o()((function*(){c(!0),yield v({status:"open"}),yield h(),yield ct(400),c(!1)}));return function(){return e.apply(this,arguments)}}(),m=function(){var e=o()((function*(e){try{yield y(e,{conversation:{status:"closed"}})}catch(t){Fe.error("Failed to close conversation",t)}}));return function(t){return e.apply(this,arguments)}}(),O=function(){var e=o()((function*(){console.log("Loading more conversations:",l),l.next&&(yield v({status:"open",after:l.next}))}));return function(){return e.apply(this,arguments)}}(),w=(function(){var e=o()((function*(e){var t=e.key;e.value<-At.default.get("window").width&&(yield m(t))}))}(),d.filter((function(e){return"open"===e.status})));return Object(D.jsxs)(R.default,{style:Mt(Mt({},I()("h-full bg-white")),{},{paddingTop:b.top,paddingBottom:b.bottom}),children:[Object(D.jsx)(_.default,{style:I()("p-4 items-center"),children:Object(D.jsx)(E.default,{style:I()("font-bold text-lg"),children:"Conversations"})}),Object(D.jsx)(_t.SwipeListView,{data:w,disableRightSwipe:!0,keyboardShouldPersistTaps:"handled",keyExtractor:function(e,t){return e.id},onEndReached:O,onEndReachedThreshold:.01,onMomentumScrollBegin:function(){console.log("onMomentumScrollBegin")},onRefresh:j,rightOpenValue:-96,refreshing:i,renderHiddenItem:function(e){var t=e.item;return Object(D.jsx)(A.default,{activeOpacity:.5,onPress:function(){return m(t.id)},style:I()("h-full bg-green-400"),children:Object(D.jsx)(_.default,{style:[I()("h-full bg-green-400 self-end justify-center items-center px-5"),{width:80}],children:Object(D.jsx)(lt.Icon,{name:"check",type:"feather",color:"white"})})})},renderItem:function(e){var t=e.item;return Object(D.jsx)(Bt,{item:t,onSelectConversation:g})},useFlatList:!0,ListFooterComponent:w.length>50?Object(D.jsx)(_.default,{style:I()("p-4 items-center"),children:l.next?Object(D.jsx)(Et.default,{}):Object(D.jsx)(E.default,{style:I()("my-6 text-gray-500"),children:"All conversations loaded \ud83d\ude80"})}):null})]})}var Nt=n(92);function Lt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ut(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Lt(Object(n),!0).forEach((function(t){f()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Lt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Tt(e){var t=e.route,n=e.navigation,r=t.params.customerId,o=Object(s.useSafeAreaInsets)(),i=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{expand:[]},n=a.useState(),r=p()(n,2),o=r[0],i=r[1],c=a.useState(),s=p()(c,2),u=s[0],l=s[1],f=a.useState(!0),d=p()(f,2),h=d[0],v=d[1];return a.useEffect((function(){v(!0),ge(e,t).then((function(e){return i(e)})).catch((function(e){return l(e)})).finally((function(){return v(!1)}))}),[e]),{customer:o,isFetching:h,error:u}}(r,{expand:["company"]}),c=i.customer,u=i.isFetching,l=i.error;if(u)return Object(D.jsx)(_.default,{style:I()("flex-1 bg-white justify-center items-center"),children:Object(D.jsx)(Et.default,{size:"large"})});if(l||!c){var f=ut(l||new Error("Unable to retrieve customer data!"));return Object(D.jsx)(_.default,{style:I()("flex-1 bg-white justify-center items-center"),children:Object(D.jsx)(E.default,{style:I()("text-base text-red-500"),children:f})})}var d,h,v=c.browser,y=c.company,b=c.email,g=c.name,j=c.os,m=c.pathname,O=c.phone,w=c.external_id,x=c.first_seen,k=c.last_seen_at,P=c.ip,C=c.profile_photo_url,B=c.time_zone,z=c.metadata,M=void 0===z?{}:z,N=!!M&&Object.keys(M).length>0,L=B&&B.length?B.split("_").join(" "):null,U=g||b||"Anonymous User",T=st(r);return Object(D.jsxs)(D.Fragment,{children:[Object(D.jsxs)(R.default,{style:Ut(Ut({},I()("flex-none bg-gray-50")),{},{paddingTop:o.top}),children:[Object(D.jsx)(_.default,{style:I()("pt-6 px-4 flex-row items-start"),children:Object(D.jsx)(A.default,{onPress:n.goBack,children:Object(D.jsx)(lt.Icon,{name:"chevron-left",type:"feather",color:Object(S.getColor)("blue-500"),onPress:n.goBack})})}),Object(D.jsxs)(_.default,{style:I()("items-center bg-gray-50 pb-4"),children:[C?Object(D.jsx)(it.default,{style:Ut({},I()("w-14 h-14 rounded-full mb-2")),source:{uri:C}}):Object(D.jsx)(_.default,{style:Ut({},I()("mb-2 w-14 h-14 bg-"+T+"-500 rounded-full items-center justify-center")),children:Object(D.jsx)(E.default,{style:I()("text-white text-xl"),children:U.slice(0,1).toUpperCase()})}),Object(D.jsx)(E.default,{style:I()("font-bold text-xl"),children:U})]})]}),Object(D.jsx)(R.default,{style:Ut({},I()("flex-1 bg-white")),children:Object(D.jsxs)(Nt.default,{style:I()("p-4"),children:[Object(D.jsx)(Ft,{title:"Basic",properties:[{name:"Email",value:b},{name:"Phone",value:O},{name:"ID",value:w}]}),Object(D.jsx)(Ft,{title:"Activity",properties:[{name:"First Seen",value:x?(h=x,ke()(h).format("MMMM D, YYYY")):null},{name:"Last Seen",value:k?(d=k,ke.a.utc(d).local().format("MMMM D, hh:mm a")):null},{name:"Last Seen URL",value:m}]}),Object(D.jsx)(Ft,{title:"Device",properties:[{name:"Timezone",value:L},{name:"Browser",value:[j,v].filter(Boolean).join(" \xb7 ")||"Unknown"},{name:"IP",value:P}]}),y&&Object(D.jsx)(Ft,{title:"Company",properties:[{name:"Name",value:y.name},{name:"Slack Channel",value:y.slack_channel_name}]}),N&&Object(D.jsx)(Ft,{title:"Metadata",properties:Object.entries(M).map((function(e){var t=p()(e,2),n=t[0],r=t[1];return{name:n,value:String(r)}}))}),Object(D.jsx)(_.default,{style:I()("p-6")})]})})]})}var Ft=function(e){var t=e.title,n=e.properties,r=e.style,o=void 0===r?{}:r;return Object(D.jsxs)(_.default,{style:Ut(Ut({},I()("pt-4 pb-2 mb-2 border-b border-gray-100")),o),children:[Object(D.jsx)(E.default,{style:I()("font-bold text-lg mb-4"),children:t}),n.map((function(e){var t=e.name,n=e.value;return Object(D.jsxs)(_.default,{style:I()("mb-4"),children:[Object(D.jsx)(E.default,{style:I()("text-gray-400 text-xs uppercase tracking-wide"),children:t}),Object(D.jsx)(E.default,{style:I()("text-base text-gray-800"),children:null!=n?n:"Unknown"})]},t)}))]})};function qt(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=$()(e);if(t){var o=$()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return G()(this,n)}}var Wt=c.a.createContext({isAuthenticated:!1,tokens:null,loading:!1,register:function(){return Promise.resolve()},login:function(){return Promise.resolve()},logout:function(){return Promise.resolve()},refresh:function(){return Promise.resolve()}}),Jt=function(){return Object(a.useContext)(Wt)},Vt=function(e){Y()(n,e);var t=qt(n);function n(e){var r;return q()(this,n),(r=t.call(this,e)).timeout=null,r.handleAuthSuccess=function(){var e=o()((function*(e){ae.set("@papercups:auth",e),r.setState({tokens:e,isAuthenticated:!0});var t=e&&e.renew_token;return r.timeout=setTimeout((function(){return r.refresh(t)}),12e5),e}));return function(t){return e.apply(this,arguments)}}(),r.handleClearAuth=function(){ae.remove("@papercups:auth"),r.setState({tokens:null,isAuthenticated:!1})},r.refresh=function(){var e=o()((function*(e){return be(e).then((function(e){return r.handleAuthSuccess(e)})).catch((function(e){Fe.error("Invalid session:",e)}))}));return function(t){return e.apply(this,arguments)}}(),r.register=function(){var e=o()((function*(e){return console.debug("Signing up!"),ye(e).then((function(e){return r.handleAuthSuccess(e)})).then((function(){console.debug("Successfully signed up!")}))}));return function(t){return e.apply(this,arguments)}}(),r.login=function(){var e=o()((function*(e){return console.debug("Logging in!"),he(e).then((function(e){return r.handleAuthSuccess(e)})).then((function(){console.debug("Successfully logged in!")}))}));return function(t){return e.apply(this,arguments)}}(),r.logout=o()((function*(){return console.debug("Logging out!"),ve().then((function(){return r.handleClearAuth()})).then((function(){console.debug("Successfully logged out!")}))})),r.state={loading:!0,isAuthenticated:!1,tokens:null},r}return J()(n,[{key:"componentDidMount",value:function(){var e=o()((function*(){var e=yield ae.get("@papercups:auth"),t=e&&e.renew_token;t?(yield this.refresh(t),this.setState({tokens:e,loading:!1})):this.setState({loading:!1})}));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){clearTimeout(this.timeout),this.timeout=null}},{key:"render",value:function(){var e=this.state,t=e.loading,n=e.isAuthenticated,r=e.tokens;return Object(D.jsx)(Wt.Provider,{value:{isAuthenticated:n,tokens:r,loading:t,register:this.register,login:this.login,logout:this.logout,refresh:this.refresh},children:this.props.children})}}]),n}(c.a.Component);function Yt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ht(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Yt(Object(n),!0).forEach((function(t){f()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Yt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Gt(){var e=Jt().login,t=a.useState(!1),r=p()(t,2),i=r[0],c=r[1],s=a.useState(""),u=p()(s,2),l=u[0],f=u[1],d=a.useState(""),h=p()(d,2),v=h[0],y=h[1],b=a.useState(null),g=p()(b,2),j=g[0],m=g[1],O=function(){var t=o()((function*(){c(!0);try{yield e({email:l,password:v}),console.log("Logged in!")}catch(n){var t=ut(n);console.error("Failed to login!",n),m(t),c(!1)}}));return function(){return t.apply(this,arguments)}}();return Object(D.jsxs)(R.default,{style:I()("h-full bg-white"),children:[Object(D.jsx)(_.default,{style:I()("mt-24 items-center"),children:Object(D.jsx)(it.default,{source:n(555),style:I()("w-24 h-24"),resizeMode:"contain"})}),Object(D.jsxs)(_.default,{style:I()("mt-8 items-center"),children:[Object(D.jsx)(E.default,{style:I()("text-3xl font-extralight mb-6"),children:"Papercups"}),Object(D.jsx)(mt.default,{style:Ht(Ht({},I()("w-72 h-12 px-4 rounded-lg border-gray-400 mb-4")),{},{borderWidth:C.default.hairlineWidth}),placeholder:"Email",onChangeText:f,autoCapitalize:"none",autoCompleteType:"off",value:l}),Object(D.jsx)(mt.default,{style:Ht(Ht({},I()("w-72 h-12 px-4 rounded-lg border-gray-400 mb-4")),{},{borderWidth:C.default.hairlineWidth}),placeholder:"Password",onChangeText:y,autoCapitalize:"none",autoCompleteType:"off",secureTextEntry:!0,value:v}),Object(D.jsx)(A.default,{style:I()("w-72 p-2 rounded-lg bg-blue-400 mt-5 items-center "+(i?"bg-opacity-40":"")),activeOpacity:.4,disabled:i,onPress:O,children:i?Object(D.jsxs)(_.default,{style:I()("flex-row items-center justify-center"),children:[Object(D.jsx)(Et.default,{color:"white"}),Object(D.jsx)(E.default,{style:I()("ml-2 text-white text-lg"),children:"Logging in..."})]}):Object(D.jsx)(E.default,{style:I()("text-white text-lg"),children:"Log in"})}),j&&Object(D.jsx)(_.default,{style:I()("mt-8"),children:Object(D.jsx)(E.default,{style:I()("text-red-500"),children:j})})]})]})}var Xt=n(168),$t=n(382),Kt=n.n($t);function Qt(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=$()(e);if(t){var o=$()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return G()(this,n)}}var Zt=ce.isDev?"wss://alex-papercups-staging.herokuapp.com/socket":"wss://app.papercups.io/socket",en=c.a.createContext({socket:new Xt.Socket(Zt),hasConnectionError:!1}),tn=function(e){Y()(n,e);var t=Qt(n);function n(e){var r;q()(this,n),(r=t.call(this,e)).createNewSocket=o()((function*(){var e=r.props.url,t=void 0===e?Zt:e,n=yield fe();return new Xt.Socket(t,{params:{token:n}})})),r.connect=function(){var e=r.state.socket;e.connect(),e.onOpen((function(){console.debug("Successfully connected to socket!")})),e.onClose((function(){console.debug("Socket successfully closed!")})),e.onError(Kt()((function(){Fe.error("Error connecting to socket. Try refreshing the app.",e),r.reconnect()}),3e4))},r.reconnect=function(){r.disconnect(o()((function*(){var e=yield de();if(!e)return r.connect();yield r.props.refresh(e);var t=yield r.createNewSocket();r.setState({socket:t,history:[t].concat(T()(r.state.history))},(function(){return r.connect()}))})))},r.disconnect=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:at,t=r.state.socket;t.disconnect(e)};var i=r.props,a=i.url,c=void 0===a?Zt:a,s=i.params,u=void 0===s?{}:s,l=new Xt.Socket(c,{params:u});return r.state={socket:l,history:[]},r}return J()(n,[{key:"componentDidMount",value:function(){var e=o()((function*(){var e=this,t=this.props.url,n=void 0===t?Zt:t,r=yield fe(),o=new Xt.Socket(n,{params:{token:r}});this.setState({socket:o,history:[o]},(function(){return e.connect()}))}));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){this.disconnect()}},{key:"render",value:function(){return Object(D.jsx)(en.Provider,{value:{socket:this.state.socket},children:this.props.children})}}]),n}(c.a.Component);function nn(e){var t=e.colorScheme;return Object(D.jsx)(k.default,{behavior:"ios"===P.default.OS?"padding":"height",style:I()("h-full"),children:Object(D.jsx)(m.default,{linking:Ct,theme:"dark"===t?O.default:w.default,children:Object(D.jsx)(on,{})})})}var rn=Object(x.default)();function on(){var e=Jt();return e.loading?null:e.isAuthenticated?Object(D.jsx)(tn,{refresh:e.refresh,children:Object(D.jsx)(en.Consumer,{children:function(e){var t=e.socket;return Object(D.jsx)(Ke,{socket:t,children:Object(D.jsxs)(rn.Navigator,{screenOptions:{headerShown:!1},children:[Object(D.jsx)(rn.Screen,{name:"Conversations",component:Rt}),Object(D.jsx)(rn.Screen,{name:"Chat",component:St}),Object(D.jsx)(rn.Screen,{name:"CustomerDetails",component:Tt}),Object(D.jsx)(rn.Screen,{name:"NotFound",component:B,options:{title:"Oops!"}})]})})}})}):Object(D.jsxs)(rn.Navigator,{screenOptions:{headerShown:!1},children:[Object(D.jsx)(rn.Screen,{name:"Login",component:Gt}),Object(D.jsx)(rn.Screen,{name:"NotFound",component:B,options:{title:"Oops!"}})]})}function an(){var e=function(){var e=a.useState(!1),t=p()(e,2),r=t[0],i=t[1];return a.useEffect((function(){function e(){return(e=o()((function*(){try{y.preventAutoHideAsync(),yield v.loadAsync(g(g({},h.default.font),{},{"space-mono":n(496)}))}catch(e){console.warn(e)}finally{i(!0),y.hideAsync()}}))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]),r}(),t=Object(j.default)();return e?Object(D.jsxs)(s.SafeAreaProvider,{children:[Object(D.jsx)(Vt,{children:Object(D.jsx)(nn,{colorScheme:t})}),Object(D.jsx)(i.StatusBar,{})]}):null}u.setNotificationHandler({handleNotification:function(){var e=o()((function*(){return{shouldShowAlert:!0,shouldPlaySound:!1,shouldSetBadge:!1}}));return function(){return e.apply(this,arguments)}}()})},404:function(e,t,n){e.exports=n(569)},496:function(e,t,n){e.exports=n.p+"./fonts/SpaceMono-Regular.ttf"},510:function(e,t){},555:function(e,t,n){e.exports=n.p+"static/media/logo.76c1fe2a.png"}},[[404,1,2]]]);
//# sourceMappingURL=app.3e51407e.chunk.js.map